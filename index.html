<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">  </head>
  <body>
    <script>

      $(document).ready(function(){
        
        drawMessages(streams.home,streams.home.length - 1);
        drawUserNames();

        $('.users').on('click',function(){
            var user = $(this).data('user');
            if(user === 'home'){
              drawMessages(streams.home,streams.home.length - 1);
            };
            else{
              drawMessages(streams.users[user],streams.users[user].length -1);
            };
        });

      });

        var drawMessages = function(stream,index){
        var $disp = $('#display_container');
        $disp.html('');

        while(index >= 0){
          var tweet = stream[index];
          var tweetParts = seperateHashTag(tweet.message);
          var $tweet = $('<div class="message_display"></div>');

          $tweet.html('<h3 class="display_username"> @' + tweet.user + '</h3>'+
           '<h5 class="display_time">' + userFriendlyTime(tweet.created_at) + '</h5>' + 
           '<p class="display_message"> ' + tweetParts.message+ '</p>' +
           '<h5 class="display_hashTag"> ' + tweetParts.hashtag + '<h5>');

          $tweet.appendTo($disp);
          index -= 1;
        };
      };

      var drawUserNames = function(){
        var $disp = $('#left_menu');
        for (var name in streams.users){
          $('<div class="users" data-user="' + name + '">' + name + '</div>').appendTo($disp);
        };
      };

      //seperates tweet.message into two parts:
      //returns object with keys message and hashtag
      var seperateHashTag = function(message){
        //this assumes only one hash tag.
        var hashmark = '#', msgLeng = message.length;
        for(var i = 0; i < msgLeng; i++){
          if(message[i] === hashmark){
            return { message: message.slice(0,i), hashtag: message.slice(i,msgLeng) };
          };
        };
        return { message: message, hashtag: ''};
      };

      //currently this returns the time elapsed in minutes hours or days
      var userFriendlyTime = function(tweetDate){
        var now = new Date();
        var elapsedTime = ( now.getTime() - tweetDate.getTime() )/(1000*60);
        if( elapsedTime < 60){
          return [Math.round(elapsedTime), 'mins ago'].join(' ');
        }
        else if( elapsedTime > 60){
          return [Math.round(elapsedTime/60), 'hours'].join(' ');
        }
        else{
          return [Math.round(elapsedTime/(60*24)), 'days ago'].join(' ');
        }
      }


    </script>

    <div id="header"> <h1> Twittler </h1> </div>
    <div id="left_menu"> 
      <h2> Users and Steams </h2>
      <div class="users" data-user="home"> home </div> 
    </div>
    <div id="display_container"> </div>
    
  </body>
</html>
